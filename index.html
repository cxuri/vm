<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cbox | CTF Environment</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.0.3/dist/tailwind.min.css" rel="stylesheet">

    <style>
        body { background-color: #0a0a0a; }
        .scanlines {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to bottom,
                rgba(255,255,255,0), rgba(255,255,255,0) 50%,
                rgba(0,0,0,0.1) 50%, rgba(0,0,0,0.1));
            background-size: 100% 4px; pointer-events: none; z-index: 10; opacity: 0.3;
        }
    </style>
</head>
<body class="flex flex-col h-screen overflow-hidden">

    <!-- HEADER -->
    <header class="flex justify-between items-center p-4 border-b border-gray-800 bg-gray-900">
        <div class="text-2xl font-bold text-white flex items-center">
            <span class="text-green-400">>&nbsp;_</span> Cbox
        </div>
        <div class="flex items-center space-x-4">
            <button id="toggleMode" class="px-3 py-1 bg-gray-800 text-gray-300 border border-gray-700 rounded hover:bg-gray-700">Split Mode</button>
            <div class="bg-gray-800 text-gray-400 rounded-full py-1 px-3 border border-gray-700 flex items-center">
                <div class="w-2 h-2 bg-green-400 rounded-full mr-2"></div>
                SYSTEM ONLINE
            </div>
        </div>
    </header>

    <!-- MAIN LAYOUT WRAPPER -->
    <main id="layout" class="flex-1 flex flex-row overflow-hidden bg-[#0b0b0c]">

        <!-- VM AREA -->
        <section id="vmSection" class="flex-none w-2/3 flex flex-col items-center justify-center p-6 relative border-r border-gray-800 bg-[#0c0c0e]">
            <div id="screen_container" class="bg-black border border-gray-800 shadow-xl rounded-xl overflow-hidden w-full h-full transition-all duration-300">
                <div style="white-space: pre; font: 14px monospace; line-height: 14px"></div>
                <canvas style="display: none"></canvas>
            </div>
        </section>

        <!-- INSTRUCTIONS PANEL -->
        <aside id="instructionsPanel" class="w-1/3 bg-[#0f0f12] border-l border-gray-800 p-6 overflow-y-auto custom-scroll">
            <h2 class="text-2xl font-semibold text-green-400 mb-4">Challenge Instructions</h2>

            <div class="text-gray-300 space-y-6 leading-relaxed">

                <section class="bg-[#141418] p-5 rounded-xl border border-gray-800 shadow-md">
                    <h3 class="text-lg font-bold text-blue-300 mb-2">üîê Objective</h3>
                    <p>Your objective is to boot the VM, explore the OS, escalate privileges if needed, and find the <span class="text-yellow-300 font-mono">flag.txt</span>.</p>
                </section>

                <section class="bg-[#141418] p-5 rounded-xl border border-gray-800 shadow-md">
                    <h3 class="text-lg font-bold text-purple-300 mb-2">üõ†Ô∏è Steps to Begin</h3>
                    <ul class="list-disc list-inside space-y-2">
                        <li>Boot the VM and examine the terminal environment.</li>
                        <li>Run basic enumeration commands.</li>
                        <li>Search for hidden files and nonstandard binaries.</li>
                        <li>Investigate potential privilege escalation vectors.</li>
                    </ul>
                </section>

                <section class="bg-[#141418] p-5 rounded-xl border border-gray-800 shadow-md mb-6">
                    <h3 class="text-lg font-bold text-red-300 mb-2">üí° Hint</h3>
                    <p>Check <span class="text-yellow-300 font-mono">/usr/local/bin/</span> ‚Äî some binaries may not behave like their standard counterparts.</p>
                </section>
            </div>
        </aside>

    </main>

    <style>
        /* smooth custom scroll */
        .custom-scroll::-webkit-scrollbar { width: 8px; }
        .custom-scroll::-webkit-scrollbar-track { background: #111; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
        .custom-scroll::-webkit-scrollbar-thumb:hover { background: #444; }
    </style>


    <div class="scanlines"></div>

    <script src="./scripts/ibv86.js"></script>
    <script>
        "use strict";

        // --- Mode Toggle Logic ---
        const toggleBtn = document.getElementById("toggleMode");
        const instructions = document.getElementById("instructionsPanel");

        let split = false;
        toggleBtn.onclick = () => {
            split = !split;
            if (split) {
                instructions.classList.remove("hidden");
                toggleBtn.textContent = "Focus Mode";
            } else {
                instructions.classList.add("hidden");
                toggleBtn.textContent = "Split Mode";
            }
        };

        // --- VM Initialization ---
        window.onload = function() {
            var emulator = window.emulator = new V86({
                wasm_path: "./boot/v86.wasm",
                memory_size: 256 * 1024 * 1024,
                vga_memory_size: 8 * 1024 * 1024,
                screen_container: document.getElementById("screen_container"),
                bios: { url: "./boot/seabios.bin" },
                vga_bios: { url: "./boot/vgabios.bin" },
                cdrom: { url: "./boot/image.iso" },
                autostart: true,
            });
        };
    </script>

</body>
</html>
